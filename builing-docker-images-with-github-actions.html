<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Hi I'm Laszlo Fogas, Devops consultant. My mission is elevating team cultures through automation and tooling. As a former engineering director I gained the perspective to effectively operate on many levels of your organization. I feel home in developer advocacy, building CI/CD pipelines and Cloud infrastructure, up to stakeholder management.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta content="Builing Docker images with Github Actions" property="og:title">
  <meta content="website" property="og:type">
  <meta content="/images/1500x500.jpg" property="og:image">
  <meta content="/laszlo.jpg" property="og:image">
  <meta content="/builing-docker-images-with-github-actions" property="og:url">
  <meta content="Laszlo Fogas" property="og:site_name">
  <meta content="Github Actions defaults are not ideal for Golang projects. This article shows how I configured GOPATH in Actions." property="og:description">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@laszlocph">
  <meta name="twitter:creator" content="@laszlocph">
  <meta name="twitter:title" content="Builing Docker images with Github Actions">
  <meta name="twitter:description" content="Github Actions defaults are not ideal for Golang projects. This article shows how I configured GOPATH in Actions.">
  <meta name="twitter:image" content="/images/1500x500.jpg">

  <title>Builing Docker images with Github Actions - Laszlo Fogas</title>
  <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css?2">
  <meta name="google-site-verification" content="rRfVaMDPujw_KMAWJY0A3P6wZ3uP8pg2_-Bp0nAbLqg" />

</head>
<body style="position: relative">
  <div class="container mx-auto max-w-6xl p-4">
    <div class="flex">
      <div class="hidden md:block md:w-3/12"></div>
      <div class="w-full md:w-6/12 max-w-xl">
        <h1><a href="./">Laszlo Fogas</a></h1>
        <img src="images/1500x500.jpg"/>
      </div>
      <div class="hidden md:block md:w-3/12"></div>
    </div>
    <div class="flex">
      <div class="hidden md:block md:w-3/12"></div>
      <div class="w-full md:w-6/12 max-w-xl">
        <h2 id="builing-docker-images-with-github-actions">Builing Docker images with Github Actions</h2>

<p>2019-09-02</p>

<p>Building Docker images in a CI pipeline is a common task. And Actions makes it convenient to do.</p>

<p>In this article I show a way to build Docker images on Github Actions.</p>

<h3 id="using-an-action">Using an action</h3>

<p>First I tried finding an action that does what I planned to do.</p>

<p>There is a Github maintained action under <a href="https://github.com/actions/docker" target="\_blank"><code class="highlighter-rouge">actions/docker</code></a>, but it looks to be using the old HCL syntax, not the new yaml one.</p>

<p>If there is no suitable action to find, defaulting to a run step always does the job.</p>

<h3 id="defaulting-to-a-run-step">Defaulting to a run step</h3>

<p>A run step can run all the commands that you run on your laptop normally. If the necessary tools are installed of course.</p>

<p>Luckilly Actions <a href="https://help.github.com/en/articles/software-in-virtual-environments-for-github-actions" target="\_blank">have docker installed</a> by default.</p>

<p>See it by running:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Docker build</span>
<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Build</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Debug</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">docker version</span>
</code></pre></div></div>

<h3 id="building-and-pushing-images-to-docker-hub">Building and pushing images to Docker Hub</h3>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Docker build</span>
<span class="na">on</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">push</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Build</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v1</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">fetch-depth</span><span class="pi">:</span> <span class="s">1</span>

    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Docker build</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="no">docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"</span>
        <span class="no">docker build -t laszlocloud/actions-test .</span>
        <span class="no">docker push laszlocloud/actions-test</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="na">DOCKER_USERNAME</span><span class="pi">:</span> <span class="s">${{ secrets.DOCKER_USERNAME }}</span>
        <span class="na">DOCKER_PASSWORD</span><span class="pi">:</span> <span class="s">${{ secrets.DOCKER_PASSWORD }}</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">docker</code> commands donâ€™t need much explanation, the only trick is in using the secrets.</p>

<p>Secrets needs to be first created in the repository settings, then included in a workflow step as an environment variable. See the documentation <a href="https://help.github.com/en/articles/virtual-environments-for-github-actions#creating-and-using-secrets-encrypted-variables" target="\_blank">here</a></p>

<p>Onwards!</p>

      </div>
      <div class="hidden md:block md:w-3/12 p-6 pl-8 font-sans text-sm text-gray-600">
        <div class="sticky top-0 pt-4">
  <p class="uppercase"><strong>On this page</strong></p>
  <ul id="toc" class="list-none w-48 pl-0">
  <li class="mb-3"><a href="#using-an-action" class="font-sans text-sm text-gray-600">Using an action</a></li>
  <li class="mb-3"><a href="#defaulting-to-a-run-step" class="font-sans text-sm text-gray-600">Defaulting to a run step</a></li>
  <li class="mb-3"><a href="#building-and-pushing-images-to-docker-hub" class="font-sans text-sm text-gray-600">Building and pushing images to Docker Hub</a></li>
</ul>

  <button class="bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded" onclick="document.body.scrollTop=0;document.documentElement.scrollTop=0;">
      Back to top
  </button>
</div>
      </div>
    </div>
  </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-84825803-1', 'auto');
  ga('send', 'pageview');

</script>

<script type="text/javascript" src="/assets/javascripts/homepage.js" async></script>
</body>
</html>
