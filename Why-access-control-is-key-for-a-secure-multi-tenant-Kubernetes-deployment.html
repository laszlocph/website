<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Laszlo Fogas, a self employed DevOps consultant going into products">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta content="Why access control is key for a secure multi-tenant Kubernetes deployment?" property="og:title">
  <meta content="website" property="og:type">
  <meta content="https://laszlo.cloud/images/kubernetes.png" property="og:image">
  <meta content="https://laszlo.cloud/laszlo.jpg" property="og:image">
  <meta content="https://laszlo.cloud/Why-access-control-is-key-for-a-secure-multi-tenant-Kubernetes-deployment" property="og:url">
  <meta content="Laszlo Fogas" property="og:site_name">
  <meta content="Why access control is key for a secure multi-tenant Kubernetes deployment?" property="og:description">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@laszlocph">
  <meta name="twitter:creator" content="@laszlocph">
  <meta name="twitter:title" content="Why access control is key for a secure multi-tenant Kubernetes deployment?">
  <meta name="twitter:description" content="Why access control is key for a secure multi-tenant Kubernetes deployment?">
  <meta name="twitter:image" content="https://laszlo.cloud/images/kubernetes.png">

  <title>Why access control is key for a secure multi-tenant Kubernetes deployment? - Laszlo Fogas</title>
  <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css?2">
  <meta name="google-site-verification" content="rRfVaMDPujw_KMAWJY0A3P6wZ3uP8pg2_-Bp0nAbLqg" />

</head>
<body style="position: relative">
  <div class="container mx-auto p-4">
    <div class="flex">
      <div class="hidden md:block md:w-3/12"></div>
      <div class="w-full md:w-6/12 max-w-xl">
        <h1><a href="./">Laszlo Fogas</a></h1>
        <img src="images/1500x500.jpg"/>
      </div>
      <div class="hidden md:block md:w-3/12"></div>
    </div>
    <div class="flex">
      <div class="hidden md:block md:w-3/12"></div>
      <div class="w-full md:w-6/12 max-w-xl">
        <h2 id="why-access-control-is-key-for-a-secure-multi-tenant-kubernetes-deployment">Why access control is key for a secure multi-tenant Kubernetes deployment?</h2>
<p>2017-07-17</p>

<p>I have a soft spot for early adopters. They are the ones who voice those - sometimes pesky - requirements that push container projects forward, making the cluster more mature and the workflow more tailored for real life usecases.</p>

<h3 id="secrets-exposed">Secrets exposed</h3>

<p>Like on my current Kubernetes project, when a few weeks back an early adopter came to me (hey Jonas!) and raised his concern around secret management: <em>“Look Laszlo, I’m a bit worried about the keys I’m uploading to Kubernetes. It seems devs from other teams are able to see them. You know, they are kind of important.. they allow access to confidential data”</em></p>

<p>He had a point. At that time there was only one shared namespace and developers saw each other’s deployments, nothing preventing them from wrongdoing. Except their morals of course.</p>

<p>It was time to iterate on the cluster and nail access control.</p>

<h3 id="access-control-introduced-in-kubernetes-v16">Access control introduced in Kubernetes v1.6</h3>

<p>The upstream Kubernetes had Role Based Access Control (RBAC) since the 1.6 release in late March, and timing couldn’t have been better for Rancher - my distribution of choice - to finally support that major release. No wonder I was so pumped seeing the announcement.</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">This is fantastic! Rancher v.1.6.3 is out with Role based access control in Kubernetes <a href="https://t.co/FT2AAE4mkp">https://t.co/FT2AAE4mkp</a> <a href="https://twitter.com/Rancher_Labs">@Rancher_Labs</a></p>&mdash; laszlocph (@laszlocph) <a href="https://twitter.com/laszlocph/status/883317597755895808">July 7, 2017</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p><br />
Access control is quite an important feature if you ask me. When I worked with the Openshift Kubernetes distribution back in January it felt natural that it has the feature, and only recently I learned that upstream Kubernetes, nor my distribution had it at the time.</p>

<p>The only workaround I could provide until now is to physically separate the clusters along the security boundaries. Which is still the best practice for test and production environments: even though one can label nodes and set up namespaces accordingly, life is easier if those environments remain phisically separate.</p>

<p>For this article I quickly checked <a href="https://docs.docker.com/engine/extend/plugins_authorization/" target="_blank">what’s up</a> in the Docker Swarm world: <em>“Docker’s out-of-the-box authorization model is all or nothing. Any user with permission to access the Docker daemon can run any Docker client command.”</em></p>

<p>But don’t I worry since <em>“Anyone with the appropriate skills can develop an authorization plugin.”</em> - well, thanks Docker!</p>

<h3 id="access-control-primitives">Access control primitives</h3>

<p>Kubernetes <a href="https://kubernetes.io/docs/admin/authorization/rbac/" target="_blank">RBAC</a> allows cluster administrators to selectively grant particular users or service accounts fine-grained access to specific resources on a per-namespace basis.</p>

<p>The key primitives are:</p>

<ul>
  <li>
    <p>Role and ClusterRole to represent a set of permissions to be granted together on a Kubernetes Namespace or on the whole cluster</p>
  </li>
  <li>
    <p>RoleBinding and ClusterRoleBinding to associate the defined Roles and ClusterRoles to users or Kubernetes ServiceAccounts</p>
  </li>
</ul>

<p>The permissions can be fine-grained: granting rights to create, get, list, update, patch, delete any of the Kubernetes API resources, be those Pods, Secrets, NameSpaces, etc.</p>

<p>But luckily Kubernetes also provides sensible defaults for system components and for three common usecases: admin, edit and view, if you don’t want to write your own page long permission set.</p>

<p>Another nice property of the Roles that they are additive.</p>

<h3 id="the-secure-and-multi-tenant-container-platform">The secure and multi-tenant container platform</h3>

<p>Using these primitives I was able to build the secure, multi-tenant container platform that multiple teams can use while not seeing or interfering with each other’s deployments or secrets.</p>

<p>And the icing on the cake was Rancher’s nice touch. Since they already support many authentication providers from Active Directory to Github, I was able to bind the RBAC roles to the Github teams that already existed in my client’s organization. How cool is that?</p>

<p>So the setup as of today follows the following principles:</p>

<ul>
  <li>Every team gets their own namespace</li>
  <li>Users are granted permissions to namespaces through their Github team membership</li>
  <li>People get the default “edit” Role within the namespace</li>
</ul>

<p>and to further protect the api keys and certificates the following workflow is introduced for secrets:</p>

<ul>
  <li>Secrets are not part of the application source code</li>
  <li>Their lifecycle is decoupled from the application by the Kubernetes Secret artifact.</li>
  <li>The source code is referencing the secrets by their logical name</li>
  <li>Secrets are prepared in the cluster by cluster admins, prior to deployment</li>
  <li>Secrets are stored in an encrypted Chef or Ansible Vault</li>
</ul>

<p>See the details on how to <a href="https://kubernetes.io/docs/concepts/configuration/secret/#overview-of-secrets" target="_blank">define secrets</a> in Kubernetes and what’s their <a href="https://kubernetes.io/docs/concepts/configuration/secret/#security-properties">security properties</a> and associated risks.</p>

<p><br /></p>

<p>Onwards!</p>


        <hr />
        <div class="font-sans text-sm text-gray-600">
          <p>Are you running Kubernetes?</p>
          You can bootstrap logging, metrics and ingress with my new project, Gimlet Stack. Head over to <a href="https://gimlet.io/concepts/gimlet-stack-concepts/">gimlet.io</a> and see if it helps you.
        </div>
      </div>
      <div class="hidden md:block md:w-3/12 p-6 pl-8 font-sans text-sm text-gray-600">
        <div class="sticky top-0 pt-4">
  <p class="uppercase"><strong>On this page</strong></p>
  <ul id="toc" class="list-none w-48 pl-0">
  <li class="mb-3"><a href="#secrets-exposed" class="font-sans text-sm text-gray-600">Secrets exposed</a></li>
  <li class="mb-3"><a href="#access-control-introduced-in-kubernetes-v16" class="font-sans text-sm text-gray-600">Access control introduced in Kubernetes v1.6</a></li>
  <li class="mb-3"><a href="#access-control-primitives" class="font-sans text-sm text-gray-600">Access control primitives</a></li>
  <li class="mb-3"><a href="#the-secure-and-multi-tenant-container-platform" class="font-sans text-sm text-gray-600">The secure and multi-tenant container platform</a></li>
</ul>

  <button class="bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded" onclick="document.body.scrollTop=0;document.documentElement.scrollTop=0;">
      Back to top
  </button>
</div>
      </div>
    </div>
  </div>
<!-- Fathom - beautiful, simple website analytics -->
<script src="https://rat.gimlet.io/script.js" site="SWFGFITA" defer></script>
<!-- / Fathom -->

<script type="text/javascript" src="/assets/javascripts/homepage.js" async></script>
</body>
</html>
