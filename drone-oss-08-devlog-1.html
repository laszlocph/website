<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Laszlo Fogas, a self employed DevOps consultant going into products">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta content="DroneOSS08 Devlog &#x23;1" property="og:title">
  <meta content="website" property="og:type">
  <meta content="https://laszlo.cloud/images/1500x500.jpg" property="og:image">
  <meta content="https://laszlo.cloud/laszlo.jpg" property="og:image">
  <meta content="https://laszlo.cloud/drone-oss-08-devlog-1" property="og:url">
  <meta content="Laszlo Fogas" property="og:site_name">
  <meta content="These are tricks I gathered over the years using Drone.io environment variables. All testable with `drone exec`." property="og:description">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@laszlocph">
  <meta name="twitter:creator" content="@laszlocph">
  <meta name="twitter:title" content="DroneOSS08 Devlog &#x23;1">
  <meta name="twitter:description" content="These are tricks I gathered over the years using Drone.io environment variables. All testable with `drone exec`.">
  <meta name="twitter:image" content="https://laszlo.cloud/images/1500x500.jpg">

  <title>DroneOSS08 Devlog &#x23;1 - Laszlo Fogas</title>
  <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css?2">
  <meta name="google-site-verification" content="rRfVaMDPujw_KMAWJY0A3P6wZ3uP8pg2_-Bp0nAbLqg" />

</head>
<body style="position: relative">
  <div class="container mx-auto p-4">
    <div class="flex">
      <div class="hidden md:block md:w-3/12"></div>
      <div class="w-full md:w-6/12 max-w-xl">
        <h1><a href="./">Laszlo Fogas</a></h1>
        <img src="images/1500x500.jpg"/>
      </div>
      <div class="hidden md:block md:w-3/12"></div>
    </div>
    <div class="flex">
      <div class="hidden md:block md:w-3/12"></div>
      <div class="w-full md:w-6/12 max-w-xl">
        <h2 id="droneoss08-devlog-1">DroneOSS08 Devlog #1</h2>

<p>2019-04-24</p>

<p>This is the first Devlog entry for the DroneOSS08 project.</p>

<p>DroneOSS08 is hosted on <a href="https://github.com/laszlocph/drone-oss-08/" target="\_blank">Github</a> and it’s a fork of Drone.io version 0.8</p>

<p>This post is a brain dump. To track progress, to not fool myself six months in the project and to fuel some sentimentalism a year from now.</p>

<h3 id="kubernetes-integration">Kubernetes integration</h3>

<p><a href="https://github.com/laszlocph/drone-oss-08/compare/kube?expand=1" target="\_blank">https://github.com/laszlocph/drone-oss-08/compare/kube?expand=1</a></p>

<p>So far so good, but this first part was the easy one. I could reuse the Apache 2.0 licensed code written by @metalmatze and then integrate it in the server. It takes only a few environment variables to enable the Kubernetes engine:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- DRONE_KUBERNETES=true
- DRONE_KUBERNETES_NAMESPACE=default
- DRONE_KUBERNETES_STORAGECLASS=example-nfs
- DRONE_KUBERNETES_VOLUME_SIZE=100Mi
- KUBECONFIG=/root/.kube/config
</code></pre></div></div>

<p>I could also test the RWX volume support through storage classes. Did a bunch of measurements as well. NFS is the simplest RWX volume to use but it has bad reputation.</p>

<p>Speed was supposed to be an issue but my first benchmarks were not terrible. A complex <code class="highlighter-rouge">bundle install</code> was taking 2 minutes, same as on my laptop. Drone Cloud was my benchmark which resulted in 2 minutes too, but one time 1:20 only. I have to do more tests, but NFS is not terrible.</p>

<p>Applied some opinions as well, all Drone pods will go into the same Kubernetes namespace. I believe I can solve the naming collision of services.</p>

<h3 id="adoption">Adoption</h3>

<p>I’m happy about adoption. I got green light from my client to install DroneOSS08 for them. Agreed that I have 6 months until the question will be raised again whether purchase Drone 1.0 licenses or stick with the fork.</p>

<p>I guess their reasoning was that 0.8 works well right now and there is no immediate reason to update to 1.0. This of course may change as 1.0 diverge. But I have some time and a large install base to test my fork.</p>

<h3 id="risks">Risks</h3>

<p>The codebase is old. To be more precise the dependencies are many years old and were not kept up to date. I’m afraid of regressions popping up due to updating them.</p>

<p>Like it happened already when I pulled in the Kubernetes Go client. Bunch of things broke, and a test too. I fear this single test failure is just the tip of the iceberg.</p>

<p>Onwards!</p>

        <hr />
        <div class="font-sans text-sm text-gray-600">
          <p>Are you running Kubernetes?</p>
          You can bootstrap logging, metrics and ingress with my new project, Gimlet Stack. Head over to <a href="https://gimlet.io/concepts/gimlet-stack-concepts/">gimlet.io</a> and see if it helps you.
        </div>
      </div>
      <div class="hidden md:block md:w-3/12 p-6 pl-8 font-sans text-sm text-gray-600">
        <div class="sticky top-0 pt-4">
  <p class="uppercase"><strong>On this page</strong></p>
  <ul id="toc" class="list-none w-48 pl-0">
  <li class="mb-3"><a href="#kubernetes-integration" class="font-sans text-sm text-gray-600">Kubernetes integration</a></li>
  <li class="mb-3"><a href="#adoption" class="font-sans text-sm text-gray-600">Adoption</a></li>
  <li class="mb-3"><a href="#risks" class="font-sans text-sm text-gray-600">Risks</a></li>
</ul>

  <button class="bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded" onclick="document.body.scrollTop=0;document.documentElement.scrollTop=0;">
      Back to top
  </button>
</div>
      </div>
    </div>
  </div>
<!-- Fathom - beautiful, simple website analytics -->
<script src="https://rat.gimlet.io/script.js" site="SWFGFITA" defer></script>
<!-- / Fathom -->

<script type="text/javascript" src="/assets/javascripts/homepage.js" async></script>
</body>
</html>
